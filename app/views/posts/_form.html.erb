<%= turbo_frame_tag "post_form" do  %>
  <div class="card shadow-sm p-3 mb-3">
    <% if post.errors.any? %>
      <div class="alert alert-danger fade show">
        <ul class="list-unstyled mb-0">
          <% post.errors.full_messages.each do |msg| %>
            <li><i class="fas fa-exclamation-circle me-2"></i><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <%#! This is form for post %>
    <%= form_with(model: post, local: false, class: "needs-validation") do |f| %>
      <div class="d-flex align-items-center mb-3">
        <div class="avatar me-2">
          <%= image_tag(current_user.avatar.presence || "default_avatar.png", class: "rounded-circle", size: "40") %>
        </div>
        <div class="flex-grow-1">
          <%= f.text_area :body, 
            class: "form-control border-0 bg-light", 
            placeholder: "What's on your mind?", 
            rows: 3 %>
        </div>
      </div>
      <div class="form-group mb-3">
        <label class="btn btn-light btn-sm">
          <i class="fas fa-image me-2"></i>Add Photo
          <%= f.file_field :image, class: "d-none" %>
        </label>
      </div>
      <div id="selected-image" class="mb-3 d-none">
        <div class="d-flex align-items-center">
          <i class="fas fa-check-circle text-success me-2"></i>
          <span>Image selected</span>
          <button type="button" class="btn-close ms-2" aria-label="Remove image"></button>
        </div>
      </div>
      <%#to JS script to make sure image has been selected %>
      <script>
        document.querySelector('input[type="file"]').addEventListener('change', function(e) {
          const selectedImage = document.getElementById('selected-image');
          if (e.target.files.length > 0) {
            selectedImage.classList.remove('d-none');
          }

          selectedImage.querySelector('.btn-close').addEventListener('click', function() {
            e.target.value = '';
            selectedImage.classList.add('d-none');
          });
        });
      </script>
      <%#to -------------------------------------------- %>
      <div class="text-end">
        <%= f.submit "Post", class: "btn btn-primary px-4" %>
      </div>
    <% end %>
  </div>
<% end %>
